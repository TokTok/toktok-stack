#!/usr/bin/env bash

# Generate haskell_targets.bzl, which is used to generate compiler flags for
# Haskell IDE integration (haskell-language-server).

set -eux -o pipefail

OUT=tools/haskell/haskell_targets.bzl

echo "# Generated by $0 > $OUT" >"$OUT.new"
echo 'HASKELL_TARGETS = [' >>"$OUT.new"
bazel query 'visible(//tools/haskell:hie-bios, kind(haskell_library, //...) union kind(haskell_binary, //...) union kind(haskell_test, //...))' |
  sed -e 's/^/    "/;s/$/",/' \
    >>"$OUT.new"
echo ']' >>"$OUT.new"
mv "$OUT.new" "$OUT"
